import{showToast as e,$emit as l,View as a,Button as t,$on as n,$off as s,Text as u}from"@dcloudio/uni-h5";import{ref as r,watch as o,onMounted as d,mergeProps as c,withCtx as i,createTextVNode as f,toDisplayString as p,createVNode as v,openBlock as g,createBlock as _,Fragment as h,renderList as m,useSSRContext as C,onUnmounted as y}from"vue";import{s as k}from"./index.9f92f74a.js";import{_ as T}from"./_plugin-vue_export-helper.1b428a4d.js";import{s as b,a as S}from"./user.9a547d09.js";import{u as R}from"./userStore.f2e6b8e0.js";import"@vue/shared";import"stream";import"./request.5320184e.js";import"axios";import"axios-miniprogram-adapter";import"../entry-server.mjs";import"@dcloudio/uni-cloud";import"vue-demi";import"@vue/server-renderer";import"@dcloudio/uni-shared";import"@dcloudio/uni-app";const D={__name:"signIn",__ssrInlineRender:!0,props:{isReplenishSign:{type:Boolean,default:!1},isFullCalendar:{type:Boolean,default:!0},yearMonth:{type:String,default:()=>`${(new Date).getFullYear()}-${(new Date).getMonth()+1}`},dataSource:{type:Array,default:()=>[]},langType:{type:String,default:"ch"}},setup(n){const s=n,u=r([]),C=r([]),y=r(0),T=r(0),b=r(parseInt((new Date).getDate())),S=r(parseInt((new Date).getMonth()+1)),R=r(parseInt((new Date).getFullYear())),D=r({ch:["日","一","二","三","四","五","六"],en:["Sun","Mon","Tues","Wed","Thur","Fri","Sat"]}),w=e=>e?e.replace(/-/g,"/"):e,x=(e,l)=>new Date(e,l,0).getDate(),I=(e,l,a=1)=>new Date(Date.UTC(e,l-1,a)).getDay(),M=(e,l,a)=>{let t=parseInt(l)+parseInt(a),n=parseInt(e);return t>12?(t=1,n++):t<1&&(t=12,n--),{month:t,year:n}},B=(a,t)=>{var n="签到";if(0==t){if(!s.isReplenishSign)return void console.log("————补签功能未开启————");n="补签"}e({title:a+"号"+n+"成功",icon:"success",position:"bottom"}),l("clickChange",y.value+"-"+T.value+"-"+a)},$=(e,l)=>{y.value=e,T.value=l,L(e,l),F(e,l),s.isFullCalendar&&W()},j=()=>{console.log("执行了");for(var e=C.value,l=u.value,a=0;a<e.length;a++)for(var t=new Date(w(e[a])).getTime(),n=0;n<l.length;n++)t==new Date(w(l[n].fullDate)).getTime()&&(l[n].isSign=!0);u.value=l},L=(e,l)=>{u.value=[];const a=I(e,l);if(a>0)for(let t=0;t<a;t++)u.value.push({date:null,fullDate:null,isBeforeToday:!0,isSign:!1,isThisMonth:!1})},F=(e,l)=>{const a=x(e,l),t=new Date(R.value+"/"+S.value+"/"+b.value);for(let n=1;n<=a;n++){const a=e+"-"+l+"-"+n,s=new Date(w(a))<t;u.value.push({date:n,fullDate:a,isBeforeToday:s,isSign:!1,isThisMonth:!0})}},N=e=>{const a=parseInt(a.value),t=parseInt(t.value),n=M(a,t,e);$(n.year,n.month),l("dateChange",a.value+"-"+t.value)},W=()=>{const e=x(y.value,T.value),l=I(y.value,T.value),a=6-I(y.value,T.value,e),t=M(y.value,T.value,-1),n=x(t.year,t.month);for(let r=0;r<l;r++){const e=n-l+r+1;u.value[r].date=e,u.value[r].fullDate=t.year+"-"+t.month+"-"+e}const s=M(y.value,T.value,1);for(let r=1;r<=a;r++)u.value.push({date:r,fullDate:s.year+"-"+s.month+"-"+r,isBeforeToday:!1,isSign:!1,isThisMonth:!1})};return o((()=>s.dataSource),((e,l)=>{C.value=e,j()}),{deep:!0}),d((()=>{/en|ch/g.test(s.langType)||(s.langType="ch");const e=s.yearMonth.split("-");var l;$(e[0],e[1]),l=s.dataSource,C.value=l,j()})),(e,l,s,r)=>{const o=a,d=t;l(k.ssrRenderComponent(o,c({class:"all"},r),{default:i(((e,l,a,t)=>{if(!l)return[v(o,{class:"bar"},{default:i((()=>[v(o,{class:"previous",onClick:e=>N(-1)},{default:i((()=>[v(d,{class:"barbtn"},{default:i((()=>[f(p("ch"==n.langType?"上一月":"Last"),1)])),_:1})])),_:1},8,["onClick"]),v(o,{class:"date"},{default:i((()=>[f(p(y.value||"--")+" 年 "+p(T.value||"--")+" 月",1)])),_:1}),v(o,{class:"next",onClick:e=>N(1)},{default:i((()=>[v(d,{class:"barbtn"},{default:i((()=>[f(p("ch"==n.langType?"下一月":"Nex/"),1)])),_:1})])),_:1},8,["onClick"])])),_:1}),v(o,{class:"week-area"},{default:i((()=>[(g(!0),_(h,null,m(D.value[n.langType],((e,l)=>(g(),_(o,{class:"week-txt",key:l},{default:i((()=>[f(p(e),1)])),_:2},1024)))),128))])),_:1}),v(o,{class:"myDateTable"},{default:i((()=>[(g(!0),_(h,null,m(u.value,((e,l)=>(g(),_(o,{key:l,class:"dateCell"},{default:i((()=>[null==e.date||null==e.date?(g(),_(o,{key:0,class:"cell"})):(g(),_(h,{key:1},[1==e.isSign?(g(),_(o,{key:0,class:"cell greenColor bgWhite"},{default:i((()=>[f(p(e.date),1)])),_:2},1024)):e.isBeforeToday&&e.isThisMonth?(g(),_(o,{key:1,onClick:l=>B(e.date,0),class:"cell outSignStyle"},{default:i((()=>[f(p(e.date)+" ",1),v(o,{class:"redDot"})])),_:2},1032,["onClick"])):e.date==b.value&&T.value==S.value&&y.value==R.value?(g(),_(o,{key:2,onClick:l=>B(e.date,1),class:"cell whiteColor bgBlue"},{default:i((()=>[f(" 签到 ")])),_:2},1032,["onClick"])):(g(),_(o,{key:3,class:"whiteColor cell"},{default:i((()=>[f(p(e.date),1)])),_:2},1024))],64))])),_:2},1024)))),128))])),_:1})];l(k.ssrRenderComponent(o,{class:"bar"},{default:i(((e,l,a,t)=>{if(!l)return[v(o,{class:"previous",onClick:e=>N(-1)},{default:i((()=>[v(d,{class:"barbtn"},{default:i((()=>[f(p("ch"==n.langType?"上一月":"Last"),1)])),_:1})])),_:1},8,["onClick"]),v(o,{class:"date"},{default:i((()=>[f(p(y.value||"--")+" 年 "+p(T.value||"--")+" 月",1)])),_:1}),v(o,{class:"next",onClick:e=>N(1)},{default:i((()=>[v(d,{class:"barbtn"},{default:i((()=>[f(p("ch"==n.langType?"下一月":"Nex/"),1)])),_:1})])),_:1},8,["onClick"])];l(k.ssrRenderComponent(o,{class:"previous",onClick:e=>N(-1)},{default:i(((e,l,a,t)=>{if(!l)return[v(d,{class:"barbtn"},{default:i((()=>[f(p("ch"==n.langType?"上一月":"Last"),1)])),_:1})];l(k.ssrRenderComponent(d,{class:"barbtn"},{default:i(((e,l,a,t)=>{if(!l)return[f(p("ch"==n.langType?"上一月":"Last"),1)];l(`${k.ssrInterpolate("ch"==n.langType?"上一月":"Last")}`)})),_:1},a,t))})),_:1},a,t)),l(k.ssrRenderComponent(o,{class:"date"},{default:i(((e,l,a,t)=>{if(!l)return[f(p(y.value||"--")+" 年 "+p(T.value||"--")+" 月",1)];l(`${k.ssrInterpolate(y.value||"--")} 年 ${k.ssrInterpolate(T.value||"--")} 月`)})),_:1},a,t)),l(k.ssrRenderComponent(o,{class:"next",onClick:e=>N(1)},{default:i(((e,l,a,t)=>{if(!l)return[v(d,{class:"barbtn"},{default:i((()=>[f(p("ch"==n.langType?"下一月":"Nex/"),1)])),_:1})];l(k.ssrRenderComponent(d,{class:"barbtn"},{default:i(((e,l,a,t)=>{if(!l)return[f(p("ch"==n.langType?"下一月":"Nex/"),1)];l(`${k.ssrInterpolate("ch"==n.langType?"下一月":"Nex/")}`)})),_:1},a,t))})),_:1},a,t))})),_:1},a,t)),l(k.ssrRenderComponent(o,{class:"week-area"},{default:i(((e,l,a,t)=>{if(!l)return[(g(!0),_(h,null,m(D.value[n.langType],((e,l)=>(g(),_(o,{class:"week-txt",key:l},{default:i((()=>[f(p(e),1)])),_:2},1024)))),128))];l("\x3c!--[--\x3e"),k.ssrRenderList(D.value[n.langType],((e,n)=>{l(k.ssrRenderComponent(o,{class:"week-txt",key:n},{default:i(((l,a,t,n)=>{if(!a)return[f(p(e),1)];a(`${k.ssrInterpolate(e)}`)})),_:2},a,t))})),l("\x3c!--]--\x3e")})),_:1},a,t)),l(k.ssrRenderComponent(o,{class:"myDateTable"},{default:i(((e,l,a,t)=>{if(!l)return[(g(!0),_(h,null,m(u.value,((e,l)=>(g(),_(o,{key:l,class:"dateCell"},{default:i((()=>[null==e.date||null==e.date?(g(),_(o,{key:0,class:"cell"})):(g(),_(h,{key:1},[1==e.isSign?(g(),_(o,{key:0,class:"cell greenColor bgWhite"},{default:i((()=>[f(p(e.date),1)])),_:2},1024)):e.isBeforeToday&&e.isThisMonth?(g(),_(o,{key:1,onClick:l=>B(e.date,0),class:"cell outSignStyle"},{default:i((()=>[f(p(e.date)+" ",1),v(o,{class:"redDot"})])),_:2},1032,["onClick"])):e.date==b.value&&T.value==S.value&&y.value==R.value?(g(),_(o,{key:2,onClick:l=>B(e.date,1),class:"cell whiteColor bgBlue"},{default:i((()=>[f(" 签到 ")])),_:2},1032,["onClick"])):(g(),_(o,{key:3,class:"whiteColor cell"},{default:i((()=>[f(p(e.date),1)])),_:2},1024))],64))])),_:2},1024)))),128))];l("\x3c!--[--\x3e"),k.ssrRenderList(u.value,((e,n)=>{l(k.ssrRenderComponent(o,{key:n,class:"dateCell"},{default:i(((l,a,t,n)=>{if(!a)return[null==e.date||null==e.date?(g(),_(o,{key:0,class:"cell"})):(g(),_(h,{key:1},[1==e.isSign?(g(),_(o,{key:0,class:"cell greenColor bgWhite"},{default:i((()=>[f(p(e.date),1)])),_:2},1024)):e.isBeforeToday&&e.isThisMonth?(g(),_(o,{key:1,onClick:l=>B(e.date,0),class:"cell outSignStyle"},{default:i((()=>[f(p(e.date)+" ",1),v(o,{class:"redDot"})])),_:2},1032,["onClick"])):e.date==b.value&&T.value==S.value&&y.value==R.value?(g(),_(o,{key:2,onClick:l=>B(e.date,1),class:"cell whiteColor bgBlue"},{default:i((()=>[f(" 签到 ")])),_:2},1032,["onClick"])):(g(),_(o,{key:3,class:"whiteColor cell"},{default:i((()=>[f(p(e.date),1)])),_:2},1024))],64))];null==e.date||null==e.date?a(k.ssrRenderComponent(o,{class:"cell"},null,t,n)):(a("\x3c!--[--\x3e"),1==e.isSign?a(k.ssrRenderComponent(o,{class:"cell greenColor bgWhite"},{default:i(((l,a,t,n)=>{if(!a)return[f(p(e.date),1)];a(`${k.ssrInterpolate(e.date)}`)})),_:2},t,n)):e.isBeforeToday&&e.isThisMonth?a(k.ssrRenderComponent(o,{onClick:l=>B(e.date,0),class:"cell outSignStyle"},{default:i(((l,a,t,n)=>{if(!a)return[f(p(e.date)+" ",1),v(o,{class:"redDot"})];a(`${k.ssrInterpolate(e.date)} `),a(k.ssrRenderComponent(o,{class:"redDot"},null,t,n))})),_:2},t,n)):e.date==b.value&&T.value==S.value&&y.value==R.value?a(k.ssrRenderComponent(o,{onClick:l=>B(e.date,1),class:"cell whiteColor bgBlue"},{default:i(((e,l,a,t)=>{if(!l)return[f(" 签到 ")];l(" 签到 ")})),_:2},t,n)):a(k.ssrRenderComponent(o,{class:"whiteColor cell"},{default:i(((l,a,t,n)=>{if(!a)return[f(p(e.date),1)];a(`${k.ssrInterpolate(e.date)}`)})),_:2},t,n)),a("\x3c!--]--\x3e"))})),_:2},a,t))})),l("\x3c!--]--\x3e")})),_:1},a,t))})),_:1},s))}}},w=D.setup;D.setup=(e,l)=>{const a=C();return(a.modules||(a.modules=new Set)).add("components/SignIn/signIn.vue"),w?w(e,l):void 0};const x=T(D,[["__scopeId","data-v-18c09f6a"]]),I={__name:"sign",__ssrInlineRender:!0,setup(e){const l=parseInt((new Date).getFullYear())+"-"+parseInt((new Date).getMonth()+1),t=r(0),o=r([]),c=R().getUserData,g=e=>{o.value.push(e),t.value++;const l={date:e,userId:c.id};b(l).then((e=>{console.log(e)}))},_=()=>{S().then((e=>{o.value=e.data.dates,t.value=o.value.length}))};return d((()=>{n("clickChange",(e=>{g(e)})),n("dateChange",(e=>{_()})),_()})),y((()=>{s("clickChange"),s("dateChange")})),(e,n,s,r)=>{const d=a,c=u;n(k.ssrRenderComponent(d,r,{default:i(((e,a,n,s)=>{if(!a)return[v(x,{yearMonth:l,dataSource:o.value,onDateChange:_,onClickChange:g},null,8,["dataSource"]),v(d,{class:"count"},{default:i((()=>[v(c,null,{default:i((()=>[f("截至目前，已坚持打卡")])),_:1}),v(d,{class:"daynumber"},{default:i((()=>[v(c,{class:"number"},{default:i((()=>[f(p(t.value),1)])),_:1}),v(c,{class:"day"},{default:i((()=>[f("天")])),_:1})])),_:1}),v(d,null,{default:i((()=>[f(" 本月累积打卡 "),v(c,{class:"monthSum"},{default:i((()=>[f(p(o.value.length),1)])),_:1}),f(" 天 ")])),_:1}),v(c,null,{default:i((()=>[f("请再接再厉，继续努力!")])),_:1})])),_:1})];a(k.ssrRenderComponent(x,{yearMonth:l,dataSource:o.value,onDateChange:_,onClickChange:g},null,n,s)),a(k.ssrRenderComponent(d,{class:"count"},{default:i(((e,l,a,n)=>{if(!l)return[v(c,null,{default:i((()=>[f("截至目前，已坚持打卡")])),_:1}),v(d,{class:"daynumber"},{default:i((()=>[v(c,{class:"number"},{default:i((()=>[f(p(t.value),1)])),_:1}),v(c,{class:"day"},{default:i((()=>[f("天")])),_:1})])),_:1}),v(d,null,{default:i((()=>[f(" 本月累积打卡 "),v(c,{class:"monthSum"},{default:i((()=>[f(p(o.value.length),1)])),_:1}),f(" 天 ")])),_:1}),v(c,null,{default:i((()=>[f("请再接再厉，继续努力!")])),_:1})];l(k.ssrRenderComponent(c,null,{default:i(((e,l,a,t)=>{if(!l)return[f("截至目前，已坚持打卡")];l("截至目前，已坚持打卡")})),_:1},a,n)),l(k.ssrRenderComponent(d,{class:"daynumber"},{default:i(((e,l,a,n)=>{if(!l)return[v(c,{class:"number"},{default:i((()=>[f(p(t.value),1)])),_:1}),v(c,{class:"day"},{default:i((()=>[f("天")])),_:1})];l(k.ssrRenderComponent(c,{class:"number"},{default:i(((e,l,a,n)=>{if(!l)return[f(p(t.value),1)];l(`${k.ssrInterpolate(t.value)}`)})),_:1},a,n)),l(k.ssrRenderComponent(c,{class:"day"},{default:i(((e,l,a,t)=>{if(!l)return[f("天")];l("天")})),_:1},a,n))})),_:1},a,n)),l(k.ssrRenderComponent(d,null,{default:i(((e,l,a,t)=>{if(!l)return[f(" 本月累积打卡 "),v(c,{class:"monthSum"},{default:i((()=>[f(p(o.value.length),1)])),_:1}),f(" 天 ")];l(" 本月累积打卡 "),l(k.ssrRenderComponent(c,{class:"monthSum"},{default:i(((e,l,a,t)=>{if(!l)return[f(p(o.value.length),1)];l(`${k.ssrInterpolate(o.value.length)}`)})),_:1},a,t)),l(" 天 ")})),_:1},a,n)),l(k.ssrRenderComponent(c,null,{default:i(((e,l,a,t)=>{if(!l)return[f("请再接再厉，继续努力!")];l("请再接再厉，继续努力!")})),_:1},a,n))})),_:1},n,s))})),_:1},s))}}},M=I.setup;I.setup=(e,l)=>{const a=C();return(a.modules||(a.modules=new Set)).add("pages/sign/sign.vue"),M?M(e,l):void 0};const B=T(I,[["__scopeId","data-v-30ef4825"]]);export{B as default};
