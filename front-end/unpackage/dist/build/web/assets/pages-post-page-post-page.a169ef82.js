import{g as e,j as a,o as l,b as s,w as t,e as u,q as o,k as c,F as n,l as r,p as d,t as i,I as p,$ as m,i as f,s as _,h as v,x as g,D as h,E as b,H as y,ag as k,z as x,ah as C,ai as j,v as T,T as V,aj as w,a4 as S,ak as F,a3 as I,al as L,Z as M,L as q}from"./index-b4edc82c.js";import{_ as P}from"./u-search.7c85f57a.js";import{r as z}from"./uni-app.es.370d9c9e.js";import{_ as D}from"./u-button.0cd44736.js";import{_ as U}from"./_plugin-vue_export-helper.1b428a4d.js";import{u as $}from"./uploads.7afe4203.js";import{u as B}from"./userStore.7c6883df.js";import{d as O}from"./card.29f73743.js";import"./u-icon.9d2312a5.js";import"./u-loading-icon.c59f05cd.js";import"./request.5e8d59d2.js";const E=U({__name:"PostPageTypeSelect",props:{showSelectModel:Boolean},setup(v){e(!1);const g=e(""),h=e(["英语四级","计算机设计大赛","证书","证","证书","zheng"]),b=e([]),y=e([]),k=()=>{m("hide")},x=e=>y.value.includes(e),C=e=>{const a=b.value.splice(e,1)[0],l=h.value.indexOf(a),s=y.value.indexOf(l);s>-1&&y.value.splice(s,1)},j=()=>{m("setType",b.value),k()};return(e,m)=>{const T=f,V=z(a("u-search"),P),w=_,S=z(a("up-button"),D);return v.showSelectModel?(l(),s(T,{key:0,class:"select_type_model"},{default:t((()=>[u(T,{class:"bg_mask",onClick:k}),u(T,{class:"select_model"},{default:t((()=>[u(T,{class:"model_title"},{default:t((()=>[o("设置标签")])),_:1}),u(T,{class:"search_type"},{default:t((()=>[u(V,{placeholder:"搜索标签",modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=e=>g.value=e),borderColor:"#eee",bgColor:"#FFF"},null,8,["modelValue"])])),_:1}),u(T,{class:"type_list_items"},{default:t((()=>[(l(!0),c(n,null,r(h.value,((e,a)=>(l(),s(T,{class:d(["type_item",{active:x(a)}]),key:a,onClick:e=>(e=>{y.value.includes(e)||b.value.length<4&&!b.value.includes(h.value[e])&&(b.value.push(h.value[e]),y.value.push(e))})(a)},{default:t((()=>[u(w,null,{default:t((()=>[o(i(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),u(T,{class:"selected_type_area"},{default:t((()=>[u(T,{class:"tips"},{default:t((()=>[o("当前选择的标签:")])),_:1}),u(T,{class:"select_warp"},{default:t((()=>[(l(!0),c(n,null,r(b.value,((e,a)=>(l(),s(T,{class:"select_type_item",key:a,onClick:C},{default:t((()=>[o(i(e),1)])),_:2},1024)))),128))])),_:1})])),_:1}),u(T,{class:"btn",style:{width:"80%","margin-top":"28rpx"}},{default:t((()=>[u(S,{type:"primary",plain:!0,text:"确定",onClick:j})])),_:1})])),_:1})])),_:1})):p("",!0)}}},[["__scopeId","data-v-3813592d"]]),H=U({__name:"post-page",setup(a){e("");const d=e([]),m=e(!1),P=e([]),z=e([]),D=e(""),U=e("");B();const H=e({});e();const J=()=>{k({count:9,sizeType:["original","compressed"],sourceType:["album"],success:e=>{0!=d.value.length?d.value.concat(e.tempFilePaths):d.value=e.tempFilePaths}})},N=e=>{L({urls:this.imgList,current:e.currentTarget.dataset.url})},R=()=>{m.value=!0},Z=e=>{M({title:"提示",content:"确定要删除这个照片吗？",cancelText:"再看看",confirmText:"删除",success:a=>{a.confirm&&(d.value.splice(e.currentTarget.dataset.index,1),d.value=d.value)}})},A=()=>{if(K()){if(""==D.value||""==U.value||0==d.value.length)return void x({title:"请填写所有信息",icon:"none"});C({title:"正在上传图片"}),$(d.value).then((e=>{P.value=e.fileNames,j(),G()}))}else x({title:"当前未登录",icon:"none"})},G=async()=>{const e={imgList:P.value,title:D.value,content:U.value,labels:z.value,authorId:H.value.id};O(e).then((e=>{const a=e.data.cardId;T({url:`/pages/card-info/card-info?id=${a}`})}))},K=()=>{const e=y("userData");return e&&(H.value=e),!!e};return v((()=>{g("setType",(e=>{e=e.map((e=>`#${e}`)),z.value=e})),g("hide",(()=>{m.value=!1})),g("checkLogin",(()=>{K()}))})),h((()=>{b("setType"),b("hide")})),(e,a)=>{const v=f,g=V,h=w,b=_,y=S,k=q,x=F;return l(),s(v,{class:"post-page"},{default:t((()=>[u(x,{onSubmit:e.formSubmit,onReset:a[2]||(a[2]=()=>{})},{default:t((()=>[u(v,{class:"cu-form-group margin-top"},{default:t((()=>[u(v,{class:"title"},{default:t((()=>[o("标题")])),_:1}),u(g,{name:"title",placeholder:"输入卡片标题",modelValue:D.value,"onUpdate:modelValue":a[0]||(a[0]=e=>D.value=e)},null,8,["modelValue"])])),_:1}),u(v,{class:"cu-form-group margin-top"},{default:t((()=>[u(h,{onClick:e.getContentValue,name:"content",maxlength:"1000",placeholder:"输入简介",modelValue:U.value,"onUpdate:modelValue":a[1]||(a[1]=e=>U.value=e)},null,8,["onClick","modelValue"])])),_:1}),u(v,{class:"cu-form-group"},{default:t((()=>[u(v,{class:"title"},{default:t((()=>[o("分类:")])),_:1}),u(v,{class:"types"},{default:t((()=>[(l(!0),c(n,null,r(z.value,((e,a)=>(l(),s(b,{key:a},{default:t((()=>[o(i(e),1)])),_:2},1024)))),128))])),_:1}),u(y,{class:"cu-btn bg-green",role:"button","aria-disabled":"false","data-target":"DrawerModalL",onClick:R},{default:t((()=>[o(" 选择 ")])),_:1})])),_:1}),u(v,{class:"cu-bar bg-white margin-top"},{default:t((()=>[u(v,{class:"action"},{default:t((()=>[o("图片上传")])),_:1}),u(v,{class:"action"},{default:t((()=>[o(i(d.value.length)+"/"+i(9),1)])),_:1})])),_:1}),u(v,{class:"cu-form-group"},{default:t((()=>[u(v,{class:"grid col-4 grid-square flex-sub"},{default:t((()=>[(l(!0),c(n,null,r(d.value,((e,a)=>(l(),s(v,{class:"bg-img",key:a,onClick:N,"data-url":d.value[a]},{default:t((()=>[u(k,{src:d.value[a],mode:"aspectFill"},null,8,["src"]),u(v,{class:"cu-tag bg-red",onClick:I(Z,["stop"]),"data-index":a},{default:t((()=>[u(b,{class:"cuIcon-close"})])),_:2},1032,["data-index"])])),_:2},1032,["data-url"])))),128)),d.value.length<9?(l(),s(v,{key:0,class:"solids",onClick:J},{default:t((()=>[u(b,{class:"cuIcon-cameraadd"})])),_:1})):p("",!0)])),_:1})])),_:1}),u(v,{class:"padding flex flex-direction"},{default:t((()=>[u(y,{class:"cu-btn bg-green margin-tb-sm lg","form-type":"submit",onClick:A},{default:t((()=>[o(" 确定发布 ")])),_:1})])),_:1})])),_:1},8,["onSubmit"]),u(E,{showSelectModel:m.value},null,8,["showSelectModel"])])),_:1})}}},[["__scopeId","data-v-c5f89072"]]);export{H as default};
