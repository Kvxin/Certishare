"use strict";const e=require("../../common/vendor.js"),t=require("./parser.js"),i=require("./markdown/index.js"),o=require("./emoji/index.js"),n=require("./highlight/index.js"),s=require("./latex/index.js"),l=require("./style/index.js"),r=require("./editable/index.js");require("./markdown/marked.min.js"),require("./highlight/prism.min.js"),require("./latex/katex.min.js"),require("./style/parser.js"),require("./editable/config.js");const a=[i.Markdown,o.Emoji,n.Highlight,s.Latex,l.Style,r.Editable],h={name:"mp-html",data:()=>({tooltip:null,slider:null,color:null,nodes:[]}),props:{editable:Boolean,placeholder:String,markdown:Boolean,containerStyle:{type:String,default:""},content:{type:String,default:""},copyLink:{type:[Boolean,String],default:!0},domain:String,errorImg:{type:String,default:""},lazyLoad:{type:[Boolean,String],default:!1},loadingImg:{type:String,default:""},pauseVideo:{type:[Boolean,String],default:!0},previewImg:{type:[Boolean,String],default:!0},scrollTable:[Boolean,String],selectable:[Boolean,String],setTitle:{type:[Boolean,String],default:!0},showImgMenu:{type:[Boolean,String],default:!0},tagStyle:Object,useAnchor:[Boolean,Number]},emits:["load","ready","imgtap","linktap","play","error"],components:{node:()=>"./node/node.js"},watch:{editable(e){this.setContent(e?this.content:this.getContent()),e||this._maskTap()},content(e){this.setContent(e)}},created(){this.plugins=[];for(let e=a.length;e--;)this.plugins.push(new a[e](this))},mounted(){!this.content&&!this.editable||this.nodes.length||this.setContent(this.content)},beforeDestroy(){this._hook("onDetached")},methods:{_containTap(){this._lock||this.slider||this.color||(this._edit=void 0,this._maskTap())},_tooltipTap(e){this._tooltipcb(e.currentTarget.dataset.i),this.$set(this,"tooltip",null)},_sliderChanging(e){this._slideringcb(e.detail.value)},_sliderChange(e){this._slidercb(e.detail.value)},_colorTap(e){this._colorcb(e.currentTarget.dataset.i),this.$set(this,"color",null)},in(e,t,i){e&&t&&i&&(this._in={page:e,selector:t,scrollTop:i})},navigateTo(t,i){return t=this._ids[decodeURI(t)]||t,new Promise(((o,n)=>{if(!this.useAnchor)return void n(Error("Anchor is disabled"));i=i||parseInt(this.useAnchor)||0;let s=" ";s=">>>";const l=e.index.createSelectorQuery().in(this._in?this._in.page:this).select((this._in?this._in.selector:"._root")+(t?`>>>#${t}`:"")).boundingClientRect();this._in?l.select(this._in.selector).scrollOffset().select(this._in.selector).boundingClientRect():l.selectViewport().scrollOffset(),l.exec((t=>{if(!t[0])return void n(Error("Label not found"));const s=t[1].scrollTop+t[0].top-(t[2]?t[2].top:0)+i;this._in?this._in.page[this._in.scrollTop]=s:e.index.pageScrollTo({scrollTop:s,duration:300}),o()}))}))},getText(e){let t="";return function e(i){for(let o=0;o<i.length;o++){const n=i[o];if("text"===n.type)t+=n.text.replace(/&amp;/g,"&");else if("br"===n.name)t+="\n";else{const i="p"===n.name||"div"===n.name||"tr"===n.name||"li"===n.name||"h"===n.name[0]&&n.name[1]>"0"&&n.name[1]<"7";i&&t&&"\n"!==t[t.length-1]&&(t+="\n"),n.children&&e(n.children),i&&"\n"!==t[t.length-1]?t+="\n":"td"!==n.name&&"th"!==n.name||(t+="\t")}}}(e||this.nodes),t},getRect(){return new Promise(((t,i)=>{e.index.createSelectorQuery().in(this).select("#_root").boundingClientRect().exec((e=>e[0]?t(e[0]):i(Error("Root label not found"))))}))},pauseMedia(){for(let e=(this._videos||[]).length;e--;)this._videos[e].pause()},setPlaybackRate(e){this.playbackRate=e;for(let t=(this._videos||[]).length;t--;)this._videos[t].playbackRate(e)},setContent(e,i){i&&this.imgList||(this.imgList=[]);const o=new t.Parser(this).parse(e);if(this.$set(this,"nodes",i?(this.nodes||[]).concat(o):o),this._videos=[],this.$nextTick((()=>{this._hook("onLoad"),this.$emit("load")})),this.lazyLoad||this.imgList._unloadimgs<this.imgList.length/2){let e=0;const t=i=>{i&&i.height||(i={}),i.height===e?this.$emit("ready",i):(e=i.height,setTimeout((()=>{this.getRect().then(t).catch(t)}),350))};this.getRect().then(t).catch(t)}else this.imgList._unloadimgs||this.getRect().then((e=>{this.$emit("ready",e)})).catch((()=>{this.$emit("ready",{})}))},_hook(e){for(let t=a.length;t--;)this.plugins[t][e]&&this.plugins[t][e]()}}};if(!Array){e.resolveComponent("node")()}const d=e._export_sfc(h,[["render",function(t,i,o,n,s,l){return e.e({a:!s.nodes[0]},s.nodes[0]?{b:e.p({childs:s.nodes,opts:[o.lazyLoad,o.loadingImg,o.errorImg,o.showImgMenu,o.selectable,o.editable,o.placeholder,"nodes"],name:"span"})}:{},{c:s.tooltip},s.tooltip?{d:e.f(s.tooltip.items,((t,i,o)=>({a:e.t(t),b:i,c:i,d:e.o(((...e)=>l._tooltipTap&&l._tooltipTap(...e)),i)}))),e:e.s("top:"+s.tooltip.top+"px")}:{},{f:s.slider},s.slider?{g:s.slider.value,h:s.slider.min,i:s.slider.max,j:e.o(((...e)=>l._sliderChanging&&l._sliderChanging(...e))),k:e.o(((...e)=>l._sliderChange&&l._sliderChange(...e))),l:e.s("top:"+s.slider.top+"px")}:{},{m:s.color},s.color?{n:e.f(s.color.items,((t,i,o)=>({a:i,b:e.s("background-color:"+t),c:i,d:e.o(((...e)=>l._colorTap&&l._colorTap(...e)),i)}))),o:e.s("top:"+s.color.top+"px")}:{},{p:e.n((o.selectable?"_select ":"")+"_root"),q:e.s((o.editable?"min-height:200px;":"")+o.containerStyle),r:e.o(((...e)=>l._containTap&&l._containTap(...e)))})}]]);wx.createComponent(d);
