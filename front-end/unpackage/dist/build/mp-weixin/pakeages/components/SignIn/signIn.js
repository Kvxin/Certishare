"use strict";const e=require("../../common/vendor.js"),a={__name:"signIn",props:{isReplenishSign:{type:Boolean,default:!1},isFullCalendar:{type:Boolean,default:!0},yearMonth:{type:String,default:()=>`${(new Date).getFullYear()}-${(new Date).getMonth()+1}`},dataSource:{type:Array,default:()=>[]},langType:{type:String,default:"ch"}},setup(a){const t=a,l=e.ref([]),n=e.ref([]),u=e.ref(0),o=e.ref(0),s=e.ref(parseInt((new Date).getDate())),r=e.ref(parseInt((new Date).getMonth()+1)),i=e.ref(parseInt((new Date).getFullYear())),v=e.ref({ch:["日","一","二","三","四","五","六"],en:["Sun","Mon","Tues","Wed","Thur","Fri","Sat"]}),d=e=>e?e.replace(/-/g,"/"):e,h=(e,a)=>new Date(e,a,0).getDate(),f=(e,a,t=1)=>new Date(Date.UTC(e,a-1,t)).getDay(),g=(e,a,t)=>{let l=parseInt(a)+parseInt(t),n=parseInt(e);return l>12?(l=1,n++):l<1&&(l=12,n--),{month:l,year:n}},c=(a,l)=>{var n="签到";if(0==l){if(!t.isReplenishSign)return void console.log("————补签功能未开启————");n="补签"}e.index.showToast({title:a+"号"+n+"成功",icon:"success",position:"bottom"}),e.index.$emit("clickChange",u.value+"-"+o.value+"-"+a)},p=(e,a)=>{u.value=e,o.value=a,T(e,a),D(e,a),t.isFullCalendar&&m()},y=()=>{console.log("执行了");for(var e=n.value,a=l.value,t=0;t<e.length;t++)for(var u=new Date(d(e[t])).getTime(),o=0;o<a.length;o++)u==new Date(d(a[o].fullDate)).getTime()&&(a[o].isSign=!0);l.value=a},T=(e,a)=>{l.value=[];const t=f(e,a);if(t>0)for(let n=0;n<t;n++)l.value.push({date:null,fullDate:null,isBeforeToday:!0,isSign:!1,isThisMonth:!1})},D=(e,a)=>{const t=h(e,a),n=new Date(i.value+"/"+r.value+"/"+s.value);for(let u=1;u<=t;u++){const t=e+"-"+a+"-"+u,o=new Date(d(t))<n;l.value.push({date:u,fullDate:t,isBeforeToday:o,isSign:!1,isThisMonth:!0})}},S=a=>{const t=parseInt(t.value),l=parseInt(l.value),n=g(t,l,a);p(n.year,n.month),e.index.$emit("dateChange",t.value+"-"+l.value)},m=()=>{const e=h(u.value,o.value),a=f(u.value,o.value),t=6-f(u.value,o.value,e),n=g(u.value,o.value,-1),s=h(n.year,n.month);for(let u=0;u<a;u++){const e=s-a+u+1;l.value[u].date=e,l.value[u].fullDate=n.year+"-"+n.month+"-"+e}const r=g(u.value,o.value,1);for(let u=1;u<=t;u++)l.value.push({date:u,fullDate:r.year+"-"+r.month+"-"+u,isBeforeToday:!1,isSign:!1,isThisMonth:!1})};return e.watch((()=>t.dataSource),((e,a)=>{n.value=e,y()}),{deep:!0}),e.onMounted((()=>{/en|ch/g.test(t.langType)||(t.langType="ch");const e=t.yearMonth.split("-");var a;p(e[0],e[1]),a=t.dataSource,n.value=a,y()})),(t,n)=>({a:e.t("ch"==a.langType?"上一月":"Last"),b:e.o((e=>S(-1))),c:e.t(u.value||"--"),d:e.t(o.value||"--"),e:e.t("ch"==a.langType?"下一月":"Nex/"),f:e.o((e=>S(1))),g:e.f(v.value[a.langType],((a,t,l)=>({a:e.t(a),b:t}))),h:e.f(l.value,((a,t,l)=>e.e({a:null==a.date||null==a.date},null==a.date||null==a.date?{}:e.e({b:1==a.isSign},1==a.isSign?{c:e.t(a.date)}:a.isBeforeToday&&a.isThisMonth?{e:e.t(a.date),f:e.o((e=>c(a.date,0)),t)}:a.date==s.value&&o.value==r.value&&u.value==i.value?{h:e.o((e=>c(a.date,1)),t)}:{i:e.t(a.date)},{d:a.isBeforeToday&&a.isThisMonth,g:a.date==s.value&&o.value==r.value&&u.value==i.value}),{j:t})))})}};wx.createComponent(a);
