"use strict";const e=require("../../../common/vendor.js"),i=require("./call-check-version.js");exports.checkUpdate=function(){return new Promise(((o,r)=>{i.callCheckVersion().then((async i=>{const n=i.code,s=i.message,t=i.url;if(n>0){const r=await e.Ws.getTempFileURL({fileList:[t]});return void 0!==r.fileList[0].tempFileURL&&(i.url=r.fileList[0].tempFileURL),i.is_silently?void e.index.downloadFile({url:t,success:e=>{200==e.statusCode&&plus.runtime.install(e.tempFilePath,{force:!1})}}):(e.index.setStorageSync("__package_info__",i),e.index.navigateTo({url:"/uni_modules/uni-upgrade-center-app/pages/upgrade-popup?local_storage_key=__package_info__",fail:i=>{console.error("更新弹框跳转失败",i),e.index.removeStorageSync("__package_info__")}}),o(i))}return n<0?(console.error(s),r(i)):o(i)})).catch((e=>{r(e)}))}))};
