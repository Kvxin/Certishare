import{g as e,ae as a,h as l,o as t,b as s,w as n,e as u,q as o,t as r,k as c,F as d,l as i,z as v,$ as f,a3 as g,i as h,x as p,D as y,E as _,s as D}from"./index-00d60881.js";import{_ as m}from"./_plugin-vue_export-helper.1b428a4d.js";import{s as k,a as C}from"./user.13d70f2c.js";import{u as S}from"./userStore.15830dc1.js";import"./request.708de9e4.js";const T=m({__name:"signIn",props:{isReplenishSign:{type:Boolean,default:!1},isFullCalendar:{type:Boolean,default:!0},yearMonth:{type:String,default:()=>`${(new Date).getFullYear()}-${(new Date).getMonth()+1}`},dataSource:{type:Array,default:()=>[]},langType:{type:String,default:"ch"}},setup(p){const y=p,_=e([]),D=e([]),m=e(0),k=e(0),C=e(parseInt((new Date).getDate())),S=e(parseInt((new Date).getMonth()+1)),T=e(parseInt((new Date).getFullYear())),w=e({ch:["日","一","二","三","四","五","六"],en:["Sun","Mon","Tues","Wed","Thur","Fri","Sat"]}),I=e=>e?e.replace(/-/g,"/"):e,b=(e,a)=>new Date(e,a,0).getDate(),M=(e,a,l=1)=>new Date(Date.UTC(e,a-1,l)).getDay(),x=(e,a,l)=>{let t=parseInt(a)+parseInt(l),s=parseInt(e);return t>12?(t=1,s++):t<1&&(t=12,s--),{month:t,year:s}},B=(e,a)=>{var l="签到";if(0==a){if(!y.isReplenishSign)return void console.log("————补签功能未开启————");l="补签"}v({title:e+"号"+l+"成功",icon:"success",position:"bottom"}),f("clickChange",m.value+"-"+k.value+"-"+e)},F=(e,a)=>{m.value=e,k.value=a,Y(e,a),$(e,a),y.isFullCalendar&&R()},j=()=>{console.log("执行了");for(var e=D.value,a=_.value,l=0;l<e.length;l++)for(var t=new Date(I(e[l])).getTime(),s=0;s<a.length;s++)t==new Date(I(a[s].fullDate)).getTime()&&(a[s].isSign=!0);_.value=a},Y=(e,a)=>{_.value=[];const l=M(e,a);if(l>0)for(let t=0;t<l;t++)_.value.push({date:null,fullDate:null,isBeforeToday:!0,isSign:!1,isThisMonth:!1})},$=(e,a)=>{const l=b(e,a),t=new Date(T.value+"/"+S.value+"/"+C.value);for(let s=1;s<=l;s++){const l=e+"-"+a+"-"+s,n=new Date(I(l))<t;_.value.push({date:s,fullDate:l,isBeforeToday:n,isSign:!1,isThisMonth:!0})}},q=e=>{const a=parseInt(a.value),l=parseInt(l.value),t=x(a,l,e);F(t.year,t.month),f("dateChange",a.value+"-"+l.value)},R=()=>{const e=b(m.value,k.value),a=M(m.value,k.value),l=6-M(m.value,k.value,e),t=x(m.value,k.value,-1),s=b(t.year,t.month);for(let u=0;u<a;u++){const e=s-a+u+1;_.value[u].date=e,_.value[u].fullDate=t.year+"-"+t.month+"-"+e}const n=x(m.value,k.value,1);for(let u=1;u<=l;u++)_.value.push({date:u,fullDate:n.year+"-"+n.month+"-"+u,isBeforeToday:!1,isSign:!1,isThisMonth:!1})};return a((()=>y.dataSource),((e,a)=>{D.value=e,j()}),{deep:!0}),l((()=>{/en|ch/g.test(y.langType)||(y.langType="ch");const e=y.yearMonth.split("-");var a;F(e[0],e[1]),a=y.dataSource,D.value=a,j()})),(e,a)=>{const l=g,v=h;return t(),s(v,{class:"all"},{default:n((()=>[u(v,{class:"bar"},{default:n((()=>[u(v,{class:"previous",onClick:a[0]||(a[0]=e=>q(-1))},{default:n((()=>[u(l,{class:"barbtn"},{default:n((()=>[o(r("ch"==p.langType?"上一月":"Last"),1)])),_:1})])),_:1}),u(v,{class:"date"},{default:n((()=>[o(r(m.value||"--")+" 年 "+r(k.value||"--")+" 月",1)])),_:1}),u(v,{class:"next",onClick:a[1]||(a[1]=e=>q(1))},{default:n((()=>[u(l,{class:"barbtn"},{default:n((()=>[o(r("ch"==p.langType?"下一月":"Nex/"),1)])),_:1})])),_:1})])),_:1}),u(v,{class:"week-area"},{default:n((()=>[(t(!0),c(d,null,i(w.value[p.langType],((e,a)=>(t(),s(v,{class:"week-txt",key:a},{default:n((()=>[o(r(e),1)])),_:2},1024)))),128))])),_:1}),u(v,{class:"myDateTable"},{default:n((()=>[(t(!0),c(d,null,i(_.value,((e,a)=>(t(),s(v,{key:a,class:"dateCell"},{default:n((()=>[null==e.date||null==e.date?(t(),s(v,{key:0,class:"cell"})):(t(),c(d,{key:1},[1==e.isSign?(t(),s(v,{key:0,class:"cell greenColor bgWhite"},{default:n((()=>[o(r(e.date),1)])),_:2},1024)):e.isBeforeToday&&e.isThisMonth?(t(),s(v,{key:1,onClick:a=>B(e.date,0),class:"cell outSignStyle"},{default:n((()=>[o(r(e.date)+" ",1),u(v,{class:"redDot"})])),_:2},1032,["onClick"])):e.date==C.value&&k.value==S.value&&m.value==T.value?(t(),s(v,{key:2,onClick:a=>B(e.date,1),class:"cell whiteColor bgBlue"},{default:n((()=>[o(" 签到 ")])),_:2},1032,["onClick"])):(t(),s(v,{key:3,class:"whiteColor cell"},{default:n((()=>[o(r(e.date),1)])),_:2},1024))],64))])),_:2},1024)))),128))])),_:1})])),_:1})}}},[["__scopeId","data-v-18c09f6a"]]),w=m({__name:"sign",setup(a){const c=parseInt((new Date).getFullYear())+"-"+parseInt((new Date).getMonth()+1),d=e(0),i=e([]),v=S().getUserData,f=e=>{i.value.push(e),d.value++;const a={date:e,userId:v.id};k(a).then((e=>{console.log(e)}))},g=()=>{C().then((e=>{i.value=e.data.dates,d.value=i.value.length}))};return l((()=>{p("clickChange",(e=>{f(e)})),p("dateChange",(e=>{g()})),g()})),y((()=>{_("clickChange"),_("dateChange")})),(e,a)=>{const l=D,v=h;return t(),s(v,null,{default:n((()=>[u(T,{yearMonth:c,dataSource:i.value,onDateChange:g,onClickChange:f},null,8,["dataSource"]),u(v,{class:"count"},{default:n((()=>[u(l,null,{default:n((()=>[o("截至目前，已坚持打卡")])),_:1}),u(v,{class:"daynumber"},{default:n((()=>[u(l,{class:"number"},{default:n((()=>[o(r(d.value),1)])),_:1}),u(l,{class:"day"},{default:n((()=>[o("天")])),_:1})])),_:1}),u(v,null,{default:n((()=>[o(" 本月累积打卡 "),u(l,{class:"monthSum"},{default:n((()=>[o(r(i.value.length),1)])),_:1}),o(" 天 ")])),_:1}),u(l,null,{default:n((()=>[o("请再接再厉，继续努力!")])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-30ef4825"]]);export{w as default};
