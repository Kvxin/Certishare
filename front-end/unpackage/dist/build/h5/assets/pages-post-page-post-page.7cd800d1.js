import{g as e,j as a,o as l,b as s,w as t,e as u,q as o,k as c,F as n,l as r,p as i,t as d,I as p,$ as m,i as f,s as _,h as v,x as g,D as h,E as b,H as k,ah as y,z as w,ai as x,aj as C,v as j,U as T,ad as S,a3 as V,ak as F,R as I,al as D,Z as L,L as M}from"./index-00d60881.js";import{_ as P}from"./u-search.23d6bae1.js";import{r as q}from"./uni-app.es.321125a8.js";import{_ as U}from"./u-button.ee418497.js";import{_ as $}from"./_plugin-vue_export-helper.1b428a4d.js";import"./request.708de9e4.js";import{u as z}from"./userStore.15830dc1.js";import{d as E}from"./card.34d15e01.js";import"./u-icon.69362ebb.js";import"./u-loading-icon.24b0e379.js";const O=$({__name:"PostPageTypeSelect",props:{showSelectModel:Boolean},setup(v){e(!1);const g=e(""),h=e(["英语四级","计算机设计大赛","证书","证","证书","zheng"]),b=e([]),k=e([]),y=()=>{m("hide")},w=e=>k.value.includes(e),x=e=>{const a=b.value.splice(e,1)[0],l=h.value.indexOf(a),s=k.value.indexOf(l);s>-1&&k.value.splice(s,1)},C=()=>{m("setType",b.value),y()};return(e,m)=>{const j=f,T=q(a("u-search"),P),S=_,V=q(a("up-button"),U);return v.showSelectModel?(l(),s(j,{key:0,class:"select_type_model"},{default:t((()=>[u(j,{class:"bg_mask",onClick:y}),u(j,{class:"select_model"},{default:t((()=>[u(j,{class:"model_title"},{default:t((()=>[o("设置标签")])),_:1}),u(j,{class:"search_type"},{default:t((()=>[u(T,{placeholder:"搜索标签",modelValue:g.value,"onUpdate:modelValue":m[0]||(m[0]=e=>g.value=e),borderColor:"#eee",bgColor:"#FFF"},null,8,["modelValue"])])),_:1}),u(j,{class:"type_list_items"},{default:t((()=>[(l(!0),c(n,null,r(h.value,((e,a)=>(l(),s(j,{class:i(["type_item",{active:w(a)}]),key:a,onClick:e=>(e=>{k.value.includes(e)||b.value.length<4&&!b.value.includes(h.value[e])&&(b.value.push(h.value[e]),k.value.push(e))})(a)},{default:t((()=>[u(S,null,{default:t((()=>[o(d(e),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),u(j,{class:"selected_type_area"},{default:t((()=>[u(j,{class:"tips"},{default:t((()=>[o("当前选择的标签:")])),_:1}),u(j,{class:"select_warp"},{default:t((()=>[(l(!0),c(n,null,r(b.value,((e,a)=>(l(),s(j,{class:"select_type_item",key:a,onClick:x},{default:t((()=>[o(d(e),1)])),_:2},1024)))),128))])),_:1})])),_:1}),u(j,{class:"btn",style:{width:"80%","margin-top":"28rpx"}},{default:t((()=>[u(V,{type:"primary",plain:!0,text:"确定",onClick:C})])),_:1})])),_:1})])),_:1})):p("",!0)}}},[["__scopeId","data-v-3813592d"]]);const N=$({__name:"post-page",setup(a){e("");const i=e([]),m=e(!1),P=e([]),q=e([]),U=e(""),$=e("");z();const N=e({});e();const R=()=>{y({count:9,sizeType:["original","compressed"],sourceType:["album"],success:e=>{0!=i.value.length?i.value.concat(e.tempFilePaths):i.value=e.tempFilePaths}})},A=e=>{D({urls:this.imgList,current:e.currentTarget.dataset.url})},B=()=>{m.value=!0},H=e=>{L({title:"提示",content:"确定要删除这个照片吗？",cancelText:"再看看",confirmText:"删除",success:a=>{a.confirm&&(i.value.splice(e.currentTarget.dataset.index,1),i.value=i.value)}})},Z=()=>{if(J()){if(""==U.value||""==$.value||0==i.value.length)return void w({title:"请填写所有信息",icon:"none"});x({title:"正在上传图片"}),async function(e){const a=new FormData;for(const s of e){const e=await fetch(s),l=await e.blob(),t=`image-${Date.now()}.jpg`;a.append("files",l,t)}try{const e=await fetch("https://share.cs.kvxin.top/uploads",{method:"POST",body:a});if(!e.ok)throw new Error("Network response was not ok.");return await e.json()}catch(l){console.error("Error:",l)}}(i.value).then((e=>{P.value=e.fileNames,C(),G()}))}else w({title:"当前未登录",icon:"none"})},G=async()=>{const e={imgList:P.value,title:U.value,content:$.value,labels:q.value,authorId:N.value.id};E(e).then((e=>{const a=e.data.cardId;j({url:`/pages/card-info/card-info?id=${a}`})}))},J=()=>{const e=k("userData");return e&&(N.value=e),!!e};return v((()=>{g("setType",(e=>{e=e.map((e=>`#${e}`)),q.value=e})),g("hide",(()=>{m.value=!1})),g("checkLogin",(()=>{J()}))})),h((()=>{b("setType"),b("hide")})),(e,a)=>{const v=f,g=T,h=S,b=_,k=V,y=M,w=F;return l(),s(v,{class:"post-page"},{default:t((()=>[u(w,{onSubmit:e.formSubmit,onReset:a[2]||(a[2]=()=>{})},{default:t((()=>[u(v,{class:"cu-form-group margin-top"},{default:t((()=>[u(v,{class:"title"},{default:t((()=>[o("标题")])),_:1}),u(g,{name:"title",placeholder:"输入卡片标题",modelValue:U.value,"onUpdate:modelValue":a[0]||(a[0]=e=>U.value=e)},null,8,["modelValue"])])),_:1}),u(v,{class:"cu-form-group margin-top"},{default:t((()=>[u(h,{onClick:e.getContentValue,name:"content",maxlength:"1000",placeholder:"输入简介",modelValue:$.value,"onUpdate:modelValue":a[1]||(a[1]=e=>$.value=e)},null,8,["onClick","modelValue"])])),_:1}),u(v,{class:"cu-form-group"},{default:t((()=>[u(v,{class:"title"},{default:t((()=>[o("分类:")])),_:1}),u(v,{class:"types"},{default:t((()=>[(l(!0),c(n,null,r(q.value,((e,a)=>(l(),s(b,{key:a},{default:t((()=>[o(d(e),1)])),_:2},1024)))),128))])),_:1}),u(k,{class:"cu-btn bg-green",role:"button","aria-disabled":"false","data-target":"DrawerModalL",onClick:B},{default:t((()=>[o(" 选择 ")])),_:1})])),_:1}),u(v,{class:"cu-bar bg-white margin-top"},{default:t((()=>[u(v,{class:"action"},{default:t((()=>[o("图片上传")])),_:1}),u(v,{class:"action"},{default:t((()=>[o(d(i.value.length)+"/"+d(9),1)])),_:1})])),_:1}),u(v,{class:"cu-form-group"},{default:t((()=>[u(v,{class:"grid col-4 grid-square flex-sub"},{default:t((()=>[(l(!0),c(n,null,r(i.value,((e,a)=>(l(),s(v,{class:"bg-img",key:a,onClick:A,"data-url":i.value[a]},{default:t((()=>[u(y,{src:i.value[a],mode:"aspectFill"},null,8,["src"]),u(v,{class:"cu-tag bg-red",onClick:I(H,["stop"]),"data-index":a},{default:t((()=>[u(b,{class:"cuIcon-close"})])),_:2},1032,["onClick","data-index"])])),_:2},1032,["data-url"])))),128)),i.value.length<9?(l(),s(v,{key:0,class:"solids",onClick:R},{default:t((()=>[u(b,{class:"cuIcon-cameraadd"})])),_:1})):p("",!0)])),_:1})])),_:1}),u(v,{class:"padding flex flex-direction"},{default:t((()=>[u(k,{class:"cu-btn bg-green margin-tb-sm lg","form-type":"submit",onClick:Z},{default:t((()=>[o(" 确定发布 ")])),_:1})])),_:1})])),_:1},8,["onSubmit"]),u(O,{showSelectModel:m.value},null,8,["showSelectModel"])])),_:1})}}},[["__scopeId","data-v-c5f89072"]]);export{N as default};
